<mat-form-field class="lookup-field" appearance="outline" subscriptSizing="dynamic">
  <mat-label>{{ label() }}</mat-label>
  <input
    matInput
    type="search"
    [placeholder]="placeholder()"
    [formControl]="searchControl"
    [matAutocomplete]="auto"
    (blur)="handleBlur()"
  />
  @if (selected() && !searchControl.disabled) {
    <button
      mat-icon-button
      matSuffix
      type="button"
      aria-label="Clear selection"
      (click)="clearSelection()"
    >
      <mat-icon>close</mat-icon>
    </button>
  }

  <app-loading-state
    matSuffix
    class="lookup-loading-state"
    [loading]="loading()"
    [error]="error()"
    [retry]="retry"
    [loadingLabel]="'Loading...'"
    [retryLabel]="'Retry'"
    [variant]="'inline'"
  ></app-loading-state>

  <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onOptionSelected($event)">
    @for (option of options(); track trackByValue(option)) {
      <mat-option [value]="option">
        {{ displayFn(option) }}
      </mat-option>
    }
    @if (!loading() && options().length === 0) {
      <mat-option disabled>No results found</mat-option>
    }
  </mat-autocomplete>

  @if (hint(); as hintValue) {
    <mat-hint>{{ hintValue }}</mat-hint>
  }
</mat-form-field>
